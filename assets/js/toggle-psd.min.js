TogglePSD={},TogglePSD.Utils={getJSON:togglePSDModels,setCookie:function(a,b,c,d,e,f){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var g="";if(c)switch(c.constructor){case Number:g=1/0===c?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}return document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":""),!0},getCookie:function(a){return a?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null}},TogglePSD.dispatcher=_.clone(Backbone.Events),TogglePSD.Control=Backbone.Model.extend({defaults:{title:"",state:"hidden",loaded:!1,imageSource:""},initialize:function(){},equals:function(a){return this.cid==a.cid}}),TogglePSD.TopLevelControl=Backbone.Model.extend({defaults:{state:"hidden"},initialize:function(){TogglePSD.dispatcher.on("toggledOn",this.onToggledOn,this),TogglePSD.dispatcher.on("toggledOff",this.onToggledOff,this)},onToggledOn:function(){this.set({state:"shown"})},onToggledOff:function(){this.set({state:"hidden"})}}),TogglePSD.ControlView=Backbone.View.extend({tagName:"li",className:"toggle-psd-node-container",events:{click:"toggle"},toggleDraggable:function(){},initialize:function(){this.onStateChange=_.bind(this.onStateChange,this),this.onStateChange(),this.listenTo(this.model,"change:state",this.onStateChange)},onStateChange:function(){var a=this.model,b=a.get("state");"shown"===b?this.$el.find(".toggle-psd-node").attr("data-state","shown"):this.$el.find(".toggle-psd-node").attr("data-state","hidden")},toggle:function(){var a=this.model,b=a.get("state");"shown"===b?TogglePSD.dispatcher.trigger("toggledOff",this.model):TogglePSD.dispatcher.trigger("toggledOn",this.model)}}),TogglePSD.PSDView=Backbone.View.extend({tagName:"img",className:"overlay",events:{mousedown:"toggle"},initialize:function(){this.listenTo(this.model,"change:state",this.onStateChange)},onStateChange:function(){var a=this.model,b=a.get("state");"shown"===b?this.$el.show():this.$el.hide()},toggle:function(a){if(3==a.which){var b=this.model;TogglePSD.dispatcher.trigger("toggledOff",b),setTimeout(function(){TogglePSD.dispatcher.trigger("toggledOn",b)},3e3)}},render:function(){this.onStateChange();var a=this.model.get("imageSource"),b=this.model.get("width");marginLeft="-"+b/2+"px",this.$el.attr("src",a).css("margin-left",marginLeft)}}),TogglePSD.TopLevelControlView=Backbone.View.extend({el:"#wp-admin-bar-toggle-psd",events:{"click .ab-item":"toggle"},initialize:function(){this.onStateChange=_.bind(this.onStateChange,this),this.onStateChange(),this.listenTo(this.model,"change:state",this.onStateChange)},onStateChange:function(){var a=this.model,b=a.get("state");"shown"===b?this.$el.attr("data-state","shown"):this.$el.attr("data-state","hidden")},toggle:function(){var a=TogglePSD.Utils.getCookie("psd-model");if(null!==a){var b=this.collection.get(a),c=b.get("state");"shown"===c?(TogglePSD.dispatcher.trigger("toggledOff",b),this.model.set({state:"hidden"})):(TogglePSD.dispatcher.trigger("toggledOn",b),this.model.set({state:"shown"}))}}}),TogglePSD.ControlCollection=Backbone.Collection.extend({model:TogglePSD.Control,initialize:function(){TogglePSD.dispatcher.on("toggledOn",this.onToggledOn,this),TogglePSD.dispatcher.on("toggledOff",this.onToggledOff,this)},onToggledOn:function(a){var b=a;TogglePSD.Utils.setCookie("psd-model",a.cid),this.each(function(a){a.equals(b)?b.set({state:"shown"}):"shown"===a.get("state")&&a.set({state:"hidden"})})},onToggledOff:function(a){a.set({state:"hidden"})},createEachModel:function(){_.each(TogglePSD.Utils.getJSON,function(a){var b=new TogglePSD.Control({title:a.title,imageSource:a.imageSource,width:a.width,element:a.element});new TogglePSD.ControlView({model:b,el:a.element}),this.add(b)},this)}}),TogglePSD.PSDCollectionView=Backbone.View.extend({el:"html",collection:null,events:{keypress:"toggle"},toggle:function(a){if(96===a.charCode){var b=TogglePSD.Utils.getCookie("psd-model");if(null===b)return;var c=this.collection.get(b),d=c.get("state");"shown"===d?(TogglePSD.dispatcher.trigger("toggledOff",c),c.set({state:"hidden"})):(TogglePSD.dispatcher.trigger("toggledOn",c),c.set({state:"shown"}))}},initialize:function(a){this.collection=a.collection,this.psdViews=[],this.createPSDViews()},createPSDViews:function(){this.collection.each(function(a){this.psdViews.push(new TogglePSD.PSDView({model:a}))},this)},render:function(){_.each(this.psdViews,function(a){this.$el.append(a.$el),a.render()},this)}}),jQuery(document).ready(function(){var a=new TogglePSD.ControlCollection;a.createEachModel();var b=new TogglePSD.PSDCollectionView({collection:a}),c=new TogglePSD.TopLevelControl;new TogglePSD.TopLevelControlView({model:c,collection:a}),b.render()});));
        }
    }
}), TogglePSD.ControlCollection = Backbone.Collection.extend({
    model: TogglePSD.Control,
    initialize: function() {
        TogglePSD.dispatcher.on("toggledOn", this.onToggledOn, this), TogglePSD.dispatcher.on("toggledOff", this.onToggledOff, this);
    },
    onToggledOn: function(model) {
        console.log("onToggledOn collection");
        var pModel = model;
        TogglePSD.Utils.setCookie("psd-model", model.cid), this.each(function(model) {
            model.equals(pModel) ? pModel.set({
                state: "shown"
            }) : "shown" === model.get("state") && model.set({
                state: "hidden"
            });
        });
    },
    onToggledOff: function(model) {
        console.log("onToggledOff collection"), model.set({
            state: "hidden"
        });
    },
    createEachModel: function() {
        _.each(TogglePSD.Utils.getJSON, function(model) {
            var newModel = new TogglePSD.Control({
                title: model.title,
                imageSource: model.imageSource,
                width: model.width,
                element: model.element
            });
            new TogglePSD.ControlView({
                model: newModel,
                el: model.element
            }), this.add(newModel);
        }, this);
    }
}), TogglePSD.PSDCollectionView = Backbone.View.extend({
    el: "html",
    collection: null,
    events: {
        keypress: "toggle"
    },
    toggle: function(event) {
        if (96 === event.charCode) {
            var modelId = TogglePSD.Utils.getCookie("psd-model");
            if (null === modelId) return;
            var model = this.collection.get(modelId), state = model.get("state");
            "shown" === state ? (TogglePSD.dispatcher.trigger("toggledOff", model), model.set({
                state: "hidden"
            })) : (TogglePSD.dispatcher.trigger("toggledOn", model), model.set({
                state: "shown"
            }));
        }
    },
    initialize: function(options) {
        this.collection = options.collection, this.psdViews = [], this.createPSDViews();
    },
    createPSDViews: function() {
        console.log(this.collection), this.collection.each(function(model) {
            this.psdViews.push(new TogglePSD.PSDView({
                model: model
            }));
        }, this);
    },
    render: function() {
        _.each(this.psdViews, function(view) {
            this.$el.append(view.$el), view.render();
        }, this);
    }
}), jQuery(document).ready(function() {
    var collection = new TogglePSD.ControlCollection();
    collection.createEachModel();
    var view = new TogglePSD.PSDCollectionView({
        collection: collection
    }), model = new TogglePSD.TopLevelControl();
    new TogglePSD.TopLevelControlView({
        model: model,
        collection: collection
    }), view.render();
});
//# sourceMappingURL=toggle-psd.min.js.map